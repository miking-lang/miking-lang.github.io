<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.15">
<title data-react-helmet="true">Miking | Miking</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="http://miking.org//docs/miking"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Miking | Miking"><meta data-react-helmet="true" name="description" content="Miking (Meta vIKING) is a meta language system for creating embedded domain-specific and general-purpose languages. Miking is not a programming language, but rather a language system for"><meta data-react-helmet="true" property="og:description" content="Miking (Meta vIKING) is a meta language system for creating embedded domain-specific and general-purpose languages. Miking is not a programming language, but rather a language system for"><link data-react-helmet="true" rel="icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="http://miking.org//docs/miking"><link data-react-helmet="true" rel="alternate" href="http://miking.org//docs/miking" hreflang="en"><link data-react-helmet="true" rel="alternate" href="http://miking.org//docs/miking" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.0eff3a3e.css">
<link rel="preload" href="/assets/js/runtime~main.0e06f18a.js" as="script">
<link rel="preload" href="/assets/js/main.e62b6b25.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><b class="navbar__title">Miking</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/miking">Documentation</a><a class="navbar__item navbar__link" href="/publications">Publications</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/miking-lang/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_Pssr toggle_TdHA toggleDisabled_jDku"><div class="toggleTrack_SSoT" role="button" tabindex="-1"><div class="toggleTrackCheck_XobZ"><span class="toggleIcon_eZtF">ðŸŒœ</span></div><div class="toggleTrackX_YkSC"><span class="toggleIcon_eZtF">ðŸŒž</span></div><div class="toggleTrackThumb_uRm4"></div></div><input type="checkbox" class="toggleScreenReader_JnkT" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_CW9Y"><nav class="menu thin-scrollbar menu_SkdO"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/docs/miking">Miking</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/miking-dppl">Miking DPPL</a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_cwdi"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_xORG"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Miking</h1><p>Miking (Meta vIKING) is a meta language system for creating embedded domain-specific and general-purpose languages. Miking is not a programming language, but rather a language system for
creating languages and generating efficient compilers.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="getting-started">Getting started<a class="hash-link" href="#getting-started" title="Direct link to heading">â€‹</a></h2><p>Before you can use the Miking system, you need to install
<a href="https://ocaml.org/" target="_blank" rel="noopener noreferrer">OCaml</a> and the
<a href="https://opam.ocaml.org/" target="_blank" rel="noopener noreferrer">OPAM</a> package manager.</p><p>After the installation, you need to install the OCaml multicore compiler by
running the following:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">opam update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">opam switch create 4.12.0+domains --packages=ocaml-variants.4.12.0+domains --repositories=multicore=git+https://github.com/ocaml-multicore/multicore-opam.git,default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">eval $(opam env)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>After this, you need to install the <code>opam</code> packages <code>dune</code> and <code>linenoise</code> by
running the following:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">opam install dune linenoise</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Note that the <code>opam switch</code> command lets you have several OCaml installations on
your system. When using the Miking system, you need to use the <code>4.12.0+domains</code>
switch. Running <code>opam switch 4.12.0+domains</code> followed by <code>eval $(opam env)</code>
always takes you back to the correct switch.</p><p>To compile the project, go back to the Miking repository and execute:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">make</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>This creates two binaries in the <code>build</code> directory: <code>build/boot</code> and
<code>build/mi</code>. <code>build/boot</code> is the bootstrap interpreter, and <code>build/mi</code>
is the main Miking executable, containing both an interpreter and a
compiler. You will mainly be using <code>mi</code>, but <code>boot</code> provides a few
features not yet available in the main executable, such as a REPL.</p><p>To run tests checking that everything has been installed correctly,
use</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">make test</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Alternatively, you can use <code>make test-all</code> to run the full test suite. Beware
that this may take some time. Alternatively you can use <code>make
test-all-prune-utests</code> which will exclude tests whose external dependencies are
not met on the current system (with the exception of <code>pyml</code>).</p><p>To run a hello world program, create a file <code>hello.mc</code> with the following code,</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">mexpr print &quot;Hello world!\n&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>and then run it using the command:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">build/mi hello.mc</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>To help Miking find its standard library, you should define the
environment variable <code>MCORE_STDLIB</code> to be the path to <code>stdlib</code>,
for example by running the following:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">cd stdlib; export MCORE_STDLIB=`pwd`; cd ..;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>To install the compiler along with the standard library for the current
user, issue:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">make install</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>This will install <code>mi</code> to <code>$HOME/.local/bin</code> and the standard library to <code>$HOME/.local/lib/mcore/stdlib</code>, according to the <a href="https://www.freedesktop.org/software/systemd/man/file-hierarchy.html" target="_blank" rel="noopener noreferrer">systemd file system hierarchy overview</a>. If <code>MCORE_STDLIB</code> is unset, Miking will look in this installation folder as its default library location.</p><p>Conversely, to uninstall, issue:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">make uninstall</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="the-repl">The REPL<a class="hash-link" href="#the-repl" title="Direct link to heading">â€‹</a></h3><p>The Miking bootstrap interpreter features a simple REPL, which lets
you interactively execute fragments of MCore code. Both toplevel
definitions and expressions can be evaluated.</p><p>To start the REPL (assuming that the interpreter is installed in the path), run</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">boot repl</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The following is an example interaction with the REPL.</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">Welcome to the MCore REPL!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Type :h for help or :q to quit.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt;&gt; let x = 5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt;&gt; let y = 10 in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> | addi x y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">15</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt;&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="editor-support">Editor Support<a class="hash-link" href="#editor-support" title="Direct link to heading">â€‹</a></h2><p>It is possible to write Miking code in any editor and compile it
via the command line. There are, however, editing modes for a
number of editors:</p><ul><li><a href="https://github.com/miking-lang/miking-emacs" target="_blank" rel="noopener noreferrer">Emacs</a></li><li><a href="https://github.com/miking-lang/miking-vim" target="_blank" rel="noopener noreferrer">Vim</a></li><li><a href="https://github.com/miking-lang/miking-sublime-text" target="_blank" rel="noopener noreferrer">Sublime</a></li></ul><p>If you create an editing mode of your own, please send a pull
request to update this list!</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="mcore">MCore<a class="hash-link" href="#mcore" title="Direct link to heading">â€‹</a></h2><p>MCore (Miking Core) is the core language of the Miking system. It is
based on a typed Lambda Calculus (Note: the type system is under
development, and the current implementation is untyped).</p><p>MCore consists of two parts:</p><ul><li><p><strong>MExpr</strong> is an MCore expression. A Miking language is always translated into an MExpr, before it is further evaluated or compiled into machine code.</p></li><li><p><strong>MLang</strong> which is a language for defining and composing language fragments. MLang is formally translated into an MExpr.</p></li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="mexpr">MExpr<a class="hash-link" href="#mexpr" title="Direct link to heading">â€‹</a></h2><p>One design objective of MExpr is to make the concrete syntax very close to the abstract syntax of the language. That is, no syntactic sugar is introduced to the concrete MCore syntax. The MExpr language is not intended to be a general-purpose programming language. Instead, the aim of MCore is to be a core language that other languages can translate into.</p><p>Nevertheless, to understand the Miking system, it is a good idea to learn to write basic programs directly as MCore expressions.</p><p>In the end, an MCore file <code>.mc</code> is always translated into an MCore expression. If an MCore file contains <code>mexpr 5</code>, it means that the final expression of the program is value <code>5</code>. That is, <code>mexpr</code> states the start of the program and is followed by the actual MExpr of the program. If the keyword <code>mexpr</code> is left out of the file, a default mexpr unit value <code>()</code> is the resulting value.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="unit-test-expressions">Unit Test Expressions<a class="hash-link" href="#unit-test-expressions" title="Direct link to heading">â€‹</a></h3><p>When writing MCore programs, it is typically done by writing explicit unit tests as part of the code. For instance</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">mexpr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">utest addi 1 2 with 3 in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">()</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>checks that the addition of <code>1</code> and <code>2</code> is in fact <code>3</code>. To run the tests in an <code>.mc</code> file, run the <code>mi</code> command with argument <code>test</code> (assuming that you have now installed <code>mi</code> in your path):</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">mi run program.mc --test</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Typically when you develop MCore programs, you do not use the <code>print</code> function. Instead, you write unit tests directly and then leave the units tests as is directly after your function. By doing so, you test your code, write regression tests, and document the informal semantics of your program directly. We strongly encourage you to develop your MCore programs this way.</p><p>In the rest of this document, we omit the <code>mexpr</code> keyword for brevity, and just write the MExpr itself. Remember to add it as appropriate when trying the various examples.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="intrinsics">Intrinsics<a class="hash-link" href="#intrinsics" title="Direct link to heading">â€‹</a></h3><p>MCore contains a number of built-in values (intrinsics) and
predefined functions and constants (part of the standard library).
For instance,</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">print &quot;Hello\n&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>uses the built-in function <code>print</code> which has the type <code>String -&gt; Unit</code>, i.e., it prints a string and returns the unit type.</p><p>The current documentation of intrinsics is implicit via code
containing <code>utest</code> expressions. Please see the following files:</p><ul><li><p><a href="/docs/test/mexpr/bool-test.mc">Boolean intrinsics</a></p></li><li><p><a href="/docs/test/mexpr/int-test.mc">Integer intrinsics</a></p></li><li><p><a href="/docs/test/mexpr/float-test.mc">Floating-point number intrinsics</a></p></li><li><p><a href="/docs/test/mexpr/string-test.mc">Strings intrinsics </a></p></li><li><p><a href="/docs/test/mexpr/seq-test.mc">Sequences intrinsics </a></p></li><li><p><a href="/docs/test/mexpr/effects.mc">Side effect (printing, I/O, debugging etc.) intrinsics</a></p></li><li><p><a href="/docs/test/mexpr/symbs.mc">Symbol intrinsics</a></p></li><li><p><a href="/docs/test/mexpr/references.mc">Reference intrinsics</a></p></li><li><p><a href="/docs/test/mexpr/random-test.mc">Random number generation intrinsics</a></p></li><li><p><a href="/docs/test/mexpr/time.mc">Time intrinsics</a></p></li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="let-expressions">Let Expressions<a class="hash-link" href="#let-expressions" title="Direct link to heading">â€‹</a></h3><p>Expressions can be given names using <code>let</code> expressions. For instance</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">let x = addi 1 2 in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>introduces a new name <code>x</code>. The built-in function <code>addi</code> performs an addition between two integers. Note that MCore uses a call-by-value evaluation order, which means that expressions are evaluated into a value before they are applied to a function or substituted using a <code>let</code> expression. Hence, the expression <code>addi 1 2</code> is evaluated before it is substituted for <code>x</code> in the rest of the expression.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="functions">Functions<a class="hash-link" href="#functions" title="Direct link to heading">â€‹</a></h3><p>Functions are always defined anonymously as lambda functions. If you would like to give a function a name, a <code>let</code> expression can be used. For instance, the following program defines a function <code>double</code> that doubles the value of its argument.</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">let double = lam x. muli x 2 in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">utest double 5 with 10 in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">()</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Types can be expressed in MCore programs, but they are currently not checked. For instance, the <code>double</code> function can be written as</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">let double = lam x:Int. muli x 2 in</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>This means that <code>double</code> has type <code>Int -&gt; Int</code>, which can also be expressed as part of the <code>let</code> expression.</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">let double : Int -&gt; Int = lam x. muli x 2 in</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>A function with several parameters are expressed using currying, using nested lambda expressions. For instance, expression</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">let foo = lam x. lam y. addi x y in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">utest foo 2 3 with 5 in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">()</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>creates a function <code>foo</code> that takes two arguments.</p><p>A lambda can also be defined without a variable, e.g., <code>lam. e</code>, where
<code>e</code> is some expression representing the body of the function. Such
notation is useful if the actual variable is not used inside <code>e</code>. Note
that <code>lam. e</code> is syntactic sugar for a normal lambda <code>lam #var&quot;&quot;. e</code>,
where the identifier of the variable name is the empty identifier.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="sequencing">Sequencing<a class="hash-link" href="#sequencing" title="Direct link to heading">â€‹</a></h3><p>Sometimes an expression has a side effect and you are not interested
in the returned value. If that is the case, you can use the sequence
operator <code>;</code>. For instance, suppose you would like to print a value in
a function before it returns:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">let foo = lam x.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  print x;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  x</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The sequence operator <code>;</code> is not a construct of pure MExpr, but
syntactic sugar for a <code>let</code> construct. For instance, the pure version
(without syntactic sugar) of the program above is as follows:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">let foo = lam x.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  let #var&quot;&quot; = print x in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  x</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Note that a variable with an empty identifier is used in the <code>let</code> expression. Moreover, note that a <code>let</code> expression</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">let _ = foo x in ...</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>is syntactically not valid since <code>let</code> expressions always bind a value to a variable. Underscore <code>_</code> is a pattern and patterns are only allowed in <code>match</code> expressions.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="if-expressions"><code>if</code> Expressions<a class="hash-link" href="#if-expressions" title="Direct link to heading">â€‹</a></h3><p>Conditional expressions can be expressed using <code>if</code> expressions. The program</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">let x = 5 in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">let answer = if (lti x 10) then &quot;yes&quot; else &quot;no&quot; in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">utest answer with &quot;yes&quot; in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">()</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>checks if <code>x</code> is less than 10 (using the <code>lti</code> function with signature <code>Int -&gt; Int -&gt; Bool</code>). If it is true, the string <code>&quot;yes&quot;</code> is returned, else string <code>&quot;no&quot;</code> is returned.</p><p>Note that an <code>if</code> expression is not a construct in pure MExpr. It is syntactic sugar for a <code>match</code> expression. That is, the expression</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">if x then e1 else e2</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>is translated into</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">match x with true then e1 else e2</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="recursion">Recursion<a class="hash-link" href="#recursion" title="Direct link to heading">â€‹</a></h3><p>A normal <code>let</code> expression cannot be used to define recursive functions. Instead, recursion can be defined using <em>recursive lets</em>, starting with the <code>recursive</code> keyword:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">recursive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">let fact = lam n.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if eqi n 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    then 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    else muli n (fact (subi n 1))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">utest fact 0 with 1 in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">utest fact 4 with 24 in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Recursive lets can also be used to define mutually recursive functions. For instance:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">recursive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">let odd = lam n.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if eqi n 1 then true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    else if lti n 1 then false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    else even (subi n 1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">let even = lam n.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if eqi n 0 then true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    else if lti n 0 then false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    else odd (subi n 1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">utest odd 4 with false in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">utest even 4 with true in</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="tuples">Tuples<a class="hash-link" href="#tuples" title="Direct link to heading">â€‹</a></h3><p>Product types can be expressed using tuples. An n-tuple is defined using syntax <code>(e_1, ..., e_n)</code> where <code>e_1</code> to <code>e_n</code> are MCore expressions. Extracting a value from a tuple (projection) is performed using an expression <code>e.n</code> where <code>e</code> is the expression that is evaluated into a tuple, and <code>n</code> is an integer number representing the index of an element in the tuple. The first index in a tuple is <code>0</code>.</p><p>For instance, in the MCore expression</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">let t = (addi 1 2, &quot;hi&quot;, 80) in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">utest t.0 with 3 in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">utest t.1 with &quot;hi&quot; in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">utest t.2 with 80 in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">()</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>we create a 3-tuple <code>t</code> and project out its values. Note that the different elements of a tuple can have different types. In this case, tuple <code>t</code> has type <code>(Int, String, Int)</code>.</p><p>Singleton tuples are also supported: <code>(x,)</code> represents a tuple with <code>x</code> as its
only element.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="records">Records<a class="hash-link" href="#records" title="Direct link to heading">â€‹</a></h3><p>Another more general form of product types are records. A record has
named fields that can have different types. For instance,</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">let r1 = {age = 42, name = &quot;foobar&quot;} in</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>defines a record of type <code>{age : int, name : string}</code>. The order of the fields does not matter:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">utest r1 with {age = 42, name = &quot;foobar&quot;} in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">utest r1 with {name = &quot;foobar&quot;, age = 42} in</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>To project out a value, a dot notation may be used.</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">utest r1.age with 42 in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">utest r1.name with &quot;foobar&quot; in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">()</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>A record type is not just a general product type in MCore, it is the only
product type. That is, a tuple is just <em>syntactic sugar</em> for a record. This means that the compiler encodes a tuple as a record, where the names of the fields are numbers <code>0</code>, <code>1</code>, etc. Labels can internally be any kind of string. For strings that cannot be defined as a normal identifier, the label form <code>#label&quot;x&quot;</code>
can be used, where <code>x</code> is the string of the label.</p><p>The following example shows how a tuple is actually encoded as a
record.</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">utest (&quot;foo&quot;,5) with {#label&quot;0&quot; = &quot;foo&quot;, #label&quot;1&quot; = 5} in ()</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="data-types-and-match-expressions">Data Types and <code>match</code> expressions<a class="hash-link" href="#data-types-and-match-expressions" title="Direct link to heading">â€‹</a></h3><p>Sum types or variant types are constructed using <code>con</code> expressions (constructor expressions). In contrast to most other functional languages, the introduction of a new data type and the introduction of constructors are separated. For instance, the expression</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">type Tree in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">con Node : (Tree,Tree) -&gt; Tree in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">con Leaf : (Int) -&gt; Tree in</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>introduces a new data type <code>Tree</code> and defines two new constructors <code>Node</code> and <code>Leaf</code>. Constructor <code>Leaf</code> takes just one argument (an integer value for the leaf) and returns a tree, whereas the <code>Node</code> constructor takes a tuple with two trees as input and constructs a new tree node.</p><p>For instance, the expression</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">let tree = Node(Node(Leaf 4, Leaf 2), Leaf 3) in</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>is a small tree named <code>tree</code>.</p><p>Assume now that we want to count the sum of the values of all leafs in a tree. We can then write a recursive function that performs the counting.</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">recursive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  let count = lam tree.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    match tree with Node t then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      let left = t.0 in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      let right = t.1 in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      addi (count left) (count right)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    else match tree with Leaf v then v</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    else error &quot;Unknown node&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">in</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The <code>match</code> expression inside the count function <em>deconstructs</em> data values by matching against a given constructor. For instance, the <code>match</code> expression</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">match tree with Node t then expr1 else expr2</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>matches the value after evaluating expression <code>tree</code> and checks if its outer most constructor is a <code>Node</code> constructor. If that is the case, the identifier <code>t</code> in expression <code>expr1</code> is bound to the tuple consisting of the node&#x27;s two sub trees (recall the definition of the constructor <code>Node</code>). Finally, if we execute the test</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">utest count tree with 9 in ()</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>we can check that the function computes the result as intended.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="pattern-matching">Pattern matching<a class="hash-link" href="#pattern-matching" title="Direct link to heading">â€‹</a></h3><p>In the previous match example, the <code>match</code> construct matched against
the constructor, but not against the actual data content. MExpr is
designed to be simple with few language constructs, at the right level
of abstraction. If the abstraction level is too low, it is hard to
perform useful static analysis and code generation. As a consequence,
MExpr support <em>patterns</em> in <code>match</code> expressions. The <code>count</code> function
can be rewritten as</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">recursive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  let count = lam tree.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    match tree with Node(left,right) then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      addi (count left) (count right)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    else match tree with Leaf v then v</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    else error &quot;Unknown node&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">in</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>where the match construct matches against pattern <code>Node(left,right)</code>,
where <code>left</code> and <code>right</code> are pattern variables.</p><p>Remember, however, that tuples are just syntactic sugar for records. Hence, match line</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">    match tree with Node(left,right) then</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>is equivalent to the following</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">    match tree with Node {#label&quot;0&quot;=left,#label&quot;1&quot;=right} then</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>where the pattern is a <em>record pattern</em>.</p><p>Pattern matching is the general form of deconstructing data in MExpr. Patterns can also be nested:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">utest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  match {foo=7,bar={more=&quot;hello&quot;}} with {foo=_,bar={more=str}} then str else &quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">with &quot;hello&quot; in</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Note also the use of <em>wildcard</em> patterns <code>_</code> (used in the <code>foo</code>
field), which matches any value.</p><p>Finally, MExpr also supports more advanced patterns, including <code>AND</code> patterns (using infix notation <code>&amp;</code>)</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">utest match (1, 2) with (a, _) &amp; b then (a, b) else (0, (0, 0)) with (1, (1, 2)) in</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p><code>OR</code> patterns (using infix notation <code>|</code>)</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">utest match K1 1 with K1 a | K2 a | K3 a then a else 0 with 1 in</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>and <code>NOT</code> patterns (using the prefix notation <code>!</code>)</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">utest match Some true with a &amp; !(None ()) then a else Some false with Some true in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">utest match None () with a &amp; !(None ()) then a else Some false with Some false in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>These are present to make it possible to translate order-dependent patterns to order-<em>in</em>dependent patterns. For example, in OCaml,</p><div class="codeBlockContainer_I0IT language-ocaml theme-code-block"><div class="codeBlockContent_wNvx ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">match</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">opt1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> opt2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token module variable" style="color:#36acaa">Some</span><span class="token plain"> a</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">_</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">_</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">Some</span><span class="token plain"> a</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">_</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">_</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>is order-dependent; any change in pattern order changes which match-arm is executed. To express this in an order-independent manner we <code>&amp;</code> every pattern with the inverse (<code>!</code>) of the union (<code>|</code>) of the previous patterns. If we pretend for a moment that OCaml supports <code>&amp;</code> and <code>!</code> in patterns they could then be written as:</p><div class="codeBlockContainer_I0IT language-ocaml theme-code-block"><div class="codeBlockContent_wNvx ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">match</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">opt1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> opt2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token module variable" style="color:#36acaa">Some</span><span class="token plain"> a</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">_</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">_</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">Some</span><span class="token plain"> a</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token module variable" style="color:#36acaa">Some</span><span class="token plain"> a</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">_</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">_</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">_</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token module variable" style="color:#36acaa">Some</span><span class="token plain"> a</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">_</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">_</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token module variable" style="color:#36acaa">Some</span><span class="token plain"> a</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The order can now be changed freely without affecting the semantics. In practice <code>&amp;</code> and <code>!</code> will probably rarely be used in manually written code, while <code>|</code> is rather more useful.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="sequences">Sequences<a class="hash-link" href="#sequences" title="Direct link to heading">â€‹</a></h3><p>An MCore sequence is constructed using syntax <code>[e_1, ..., e_n]</code>. All elements in a sequence must have the same type. For instance, an expression</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">[1,3,6,7,22,3]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>has type <code>[Int]</code> whereas and expression</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">[&quot;this&quot;, &quot;is&quot;, &quot;a&quot;, &quot;test&quot;]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>has type <code>[String]</code>.</p><p>A string itself is actually a sequence of characters. Hence,</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">utest &quot;foo&quot; with [&#x27;f&#x27;,&#x27;o&#x27;,&#x27;o&#x27;] in ()</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>is correct. This means that the type <code>String</code> is just an abbreviation for the sequence type <code>[Char]</code>.</p><p>There are several operations defined for sequences, for instance, the <code>concat</code> function concatenates two sequences</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">utest concat [1,3,5] [7,9] with [1,3,5,7,9] in ()</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>or the <code>get</code> function picks out the nth element of a sequence</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">utest get [3,5,8,9] 2 with 8 in ()</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>It is also possible to pattern match on sequences, to either extract the <em>tail</em> of a sequence, if the first part matches</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">utest match &quot;foobar&quot; with &quot;fo&quot; ++ rest then rest else &quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">with &quot;obar&quot; in</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>or the <em>head</em> of a sequence if the last part matches:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">utest match &quot;foobar&quot; with first ++ &quot;bar&quot; then first else &quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">with &quot;foo&quot; in</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>It is even possible to extract the middle of a sequence, if the head and the tail matches:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">utest match &quot;foobar&quot; with &quot;fo&quot; ++ mid ++ &quot;ar&quot; then mid else &quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">with &quot;ob&quot; in</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Again, matching can be combined and nested:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">utest match (1,[[&quot;a&quot;,&quot;b&quot;],[&quot;c&quot;]],76) with (1,b++[[&quot;c&quot;]],76) then b else []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">with [[&quot;a&quot;,&quot;b&quot;]] in</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="tensors">Tensors<a class="hash-link" href="#tensors" title="Direct link to heading">â€‹</a></h3><p>Tensors are mutable data structures and can be of up to rank 16. The index
of an element is represented as a sequence of integers.</p><p>We construct tensors using <code>tensorCreateDense shape f</code>, where <code>shape</code> is a sequence
denoting the shape of the tensor and <code>f</code> is a function taking an index as an
argument and returning the element at that index.</p><p>We can construct a zero-order tensor with value <code>&#x27;a&#x27;</code> as</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">let t0 = tensorCreateDense [] (lam. &#x27;a&#x27;) in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">utest tensorRank t0 with 0 in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">utest tensorShape t0 with [] in</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>We can access and mutate elements in a tensor using</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">utest tensorSetExn t0 [] &#x27;b&#x27; with () in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">utest tensorGetExn t0 [] with &#x27;b&#x27; in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">()</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The file <a href="/docs/stdlib/tensor.mc">tensor.mc</a> contains a wide variety of useful tensor
functions. We can import it into a program using the <code>include</code>
keyword (more on this <a href="#MLang">later</a>). We can construct a rank 1
tensor (i.e. vector) as</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">include &quot;tensor.mc&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mexpr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">let t1 = tensorCreateDense [9] (lam i. addi (get i 0) 1) in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">utest tensorToSeqExn t1 with [1, 2, 3, 4, 5, 6, 7, 8, 9] in</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>where <code>tensorToSeqExn</code> is defined in <code>tensor.mc</code>.</p><p>We can reshape our rank 1 tensor into a rank 2 tensor (i.e. a matrix).</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">let t2 = tensorReshapeExn t1 [3, 3] in</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Reshape does no copying and the data is shared between <code>t1</code> and <code>t2</code></p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">tensorSetExn t2 [0, 0] 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">utest tensorGetExn t1 [0] with 2 in</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>We can slice the second row from <code>t2</code> as</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">let r2 = tensorSliceExn t2 [1] in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">utest tensorToSeqExn r2 with [4, 5, 6] in</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Slicing reduces the rank of the tensor</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">utest tensorRank r2 with 1 in</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>We can slice multiple dimensions at once</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">let e = tensorSliceExn t2 [1, 1] in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">utest tensorGetExn e [] with 5 in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">utest tensorRank e with 0 in</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>A slice shares data with the original tensor and no copying of data is done.</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">tensorMapInplace (lam. 0) r2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">utest tensorToSeqExn t1 with [2, 2, 3, 0, 0, 0, 7, 8, 9] in</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>where we use <code>tensorMapInplace</code> from <code>tensor.mc</code>.</p><p>We can get a subset of the rows of t2 by restricting its 0th dimension.</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">let s1 = tensorSubExn t2 1 2 in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">utest tensorShape s1 with [2, 3] in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">utest tensorToSeqExn (tensorReshapeExn s1 [6]) with [0, 0, 0, 7, 8, 9] in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">()</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="references">References<a class="hash-link" href="#references" title="Direct link to heading">â€‹</a></h3><p>A mutable reference to an MExpr value can be created with the <code>ref</code> operator. For instance</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">let r = ref 3 in</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>allocates a reference to a cell in memory with an initial value <code>3</code>, and binds
the reference to the variable <code>r</code>.</p><p>The <code>deref</code> operator is used for dereferencing, that is, to read the value that
a reference points to:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">let r = ref 3 in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">utest deref r with 3 in ()</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The value that a reference points to can be modified using the <code>modref</code> operator:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">let r = ref 3 in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">modref r 4;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">utest deref r with 4 in ()</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Note that the return value of <code>modref</code> is an MExpr unit value.</p><p>It is possible have aliases for the same memory cell by binding several
variables to the same reference. As an example, in the program</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">let r1 = ref &quot;A&quot; in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">let r2 = r1 in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">modref r2 &quot;B&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">utest deref r1 with &quot;B&quot; in ()</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>the change made to the referenced value via the variable <code>r2</code> is visible when
dereferencing the reference via the variable <code>r1</code>.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="mlang">MLang<a class="hash-link" href="#mlang" title="Direct link to heading">â€‹</a></h2><p>MLang is a superset of MExpr, and is used to define and compose
reusable language fragments. It also supports top-level
definitions and simple file inclusion. The definitions can be
translated into pure MExpr definitions, and can be run as any
other MExpr programs.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="top-level-definitions-and-includes">Top-Level Definitions and Includes<a class="hash-link" href="#top-level-definitions-and-includes" title="Direct link to heading">â€‹</a></h3><p>Values, types, and data constructors can be defined top-level,
before the <code>mexpr</code> keyword of an MCore program. The syntax is
identical to that of the corresponding MExpr definitions, without
the trailing <code>in</code>:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">let id = lam x. x</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type T</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">con Foo : Int -&gt; T</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mexpr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">utest id (Foo 42) with Foo 42 in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">()</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The translation into MExpr is straightforward: the definitions are
simply moved into the beginning of the <code>mexpr</code> program. The
usefulness of top-level definitions becomes more apparent when
adding included files. A file can be included using the syntax</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">include &quot;path/to/prog.mc&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>before any top-level definitions in a
file. The string is a file path relative to the file that contains
the <code>include</code>. If the environment variable <code>MCORE_STDLIB</code> is
defined, its value is used as a fallback path to search from if
the file is not found relative to the original file. Files are
included transitively in a depth-first fashion, and files that are
included from several files are only included once. File
inclusions that form a loop are not allowed.</p><p>Including a file is equivalent to inserting all the top-level
definitions of that file. There are no namespaces and no
disambiguation; if a name defined in an included file is shadowed
in the including file, the included definition becomes
unavailable.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="language-fragments">Language Fragments<a class="hash-link" href="#language-fragments" title="Direct link to heading">â€‹</a></h3><p>A language fragment contains definitions of (abstract) syntax, and
semantics (&quot;interpreters&quot;) for that fragment. Any number of
language fragments can be defined before the <code>mexpr</code> keyword in an
MCore program. For example, here is a language fragment for simple
arithmetics:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">lang Arith</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  syn Expr =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | Num Int</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | Add (Expr, Expr)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sem eval =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | Num n -&gt; Num n</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | Add (e1,e2) -&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    match eval e1 with Num n1 then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      match eval e2 with Num n2 then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Num (addi n1 n2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      else error &quot;Not a number&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    else error &quot;Not a number&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The fragment defines a syntactic form with two cases called
<code>Expr</code>, and an interpreter called <code>eval</code>. An interpreter in MLang
is a function that is always defined by cases over its last
argument (here, <code>eval</code> takes only a single argument). The body of
a case is a regular MExpr term, which has access to the name of
the value (if any) carried by the current syntactic form.</p><p>In the main MExpr program, a language fragment can be opened by
a <code>use</code> expression:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">mexpr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use Arith in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">utest eval (Add (Num 2, Num 3)) with Num 5 in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">()</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>A <code>use</code> is translated into a series of MExpr definitions that
match the syntax and semantics of the specified language fragment.</p><p>An important feature of language fragments is that they can be
composed to form new language fragments. As an example, we might
want to extend our arithmetics language with booleans and <code>if</code>
expressions:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">lang MyBool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  syn Expr =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | True()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | False()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | If (Expr, Expr, Expr)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sem eval =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | True() -&gt; True()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | False() -&gt; False()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | If(cnd,thn,els) -&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let cndVal = eval cnd in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    match cndVal with True() then eval thn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    else match cndVal with False() then eval els</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    else error &quot;Not a boolean&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lang ArithBool = Arith + MyBool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mexpr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use ArithBool in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">utest eval (Add (If (False(), Num 0, Num 5), Num 2)) with Num 7 in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">()</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The language fragment <code>ArithBool</code> is indistinguishable from a
language fragment with all the syntactic and semantic cases of
<code>Arith</code> and <code>MyBool</code> merged. If we wanted, we could have added new
cases to the language composition as well, and refer to the syntax
and semantics of the fragments being composed:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">lang ArithBool = Arith + MyBool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  syn Expr =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | IsZero Expr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sem eval =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | IsZero e -&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    match eval e with Num n then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      if eqi n 0 then True() else False()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      error &quot;Not a number&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="known-issuesfuture-work">Known Issues/Future Work<a class="hash-link" href="#known-issuesfuture-work" title="Direct link to heading">â€‹</a></h3><ul><li>Name binding in language definitions is dynamic in where the
language is used, meaning that shadowing can change behavior in
unexpected ways (a type system would address this to some
extent).</li><li>There are cases where it would be useful to <code>use</code> language
fragments top-level, for example when defining top-level
functions that use datatypes defined in language fragments.</li><li>The intended rules of interpreter composition are as follows:<ul><li>If a language defines a case c1 that overlaps with a case c2
from a language being extended, c1 takes precedence (cf.
overriding in inheritance).</li><li>If a language extends two languages which both define the same
case for an interpreter, the extending language <em>must</em> provide
an overriding case for that interpreter.</li></ul></li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="externals-builtin">Externals (builtin)<a class="hash-link" href="#externals-builtin" title="Direct link to heading">â€‹</a></h2><p>As part of the experimental setup of Miking, we currently support a way
to use external libraries without interfering with the development of
Miking that does not need these external dependencies.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="python">Python<a class="hash-link" href="#python" title="Direct link to heading">â€‹</a></h3><p>Python intrinsics, which allow calling Python code from MCore, are offered as an optional feature for the <code>boot</code> bootstrap interpreter.
To build the project with Python integration you need to have <a href="https://www.python.org" target="_blank" rel="noopener noreferrer">Python 3</a> installed on your system.
You will also need to install any Python libraries you want to use (for example using pip).</p><p>In addition, you need the <a href="https://github.com/thierry-martinez/pyml" target="_blank" rel="noopener noreferrer">pyml</a> OCaml Python bindings, available via <code>opam</code>:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">opam install pyml</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p><code>boot</code> will automatically be compiled with Python support when the <code>pyml</code> package is installed.</p><p>NOTE: Currently, there seems to be a problem with the current OPAM bindings with the multicore switch. If the above command fails, try to run the following and then install <code>pyml</code> again:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">opam pin stdcompat 15</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>To run the Python-specific test suite:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">make test-boot-py</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>To install for the current user, run <code>make install</code> as usual.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="usage">Usage<a class="hash-link" href="#usage" title="Direct link to heading">â€‹</a></h4><p>The following example shows how to use the intrinsics to sort a sequence using
Python&#x27;s builtin <code>sorted</code> function.</p><div class="codeBlockContainer_I0IT language-ocaml theme-code-block"><div class="codeBlockContent_wNvx ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> builtins </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pyimport </span><span class="token string" style="color:#e3116c">&quot;builtins&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> x </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">5.</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">4.5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">4.</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">1.</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">1.5</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> y </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pycall builtins </span><span class="token string" style="color:#e3116c">&quot;sorted&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> x_sorted </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pyconvert y</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p><code>pycall</code> is the main piece of the Python intrinsics: in the example above,
it is used to call the function <code>sorted</code> from the <code>builtins</code> module, imported
with the <code>pyimport</code> intrinsic. As the example shows, arguments are
passed to the <code>pycall</code> intrinsic using tuples (remember that <code>(x,)</code> is a
singleton tuple containing <code>x</code>). The result of a <code>pycall</code> (<code>y</code> in the example
above) is a Python value, which can either be passed to other Python functions,
or converted back to an MCore sequence using the <code>pyconvert</code> builtin.</p><p><code>pycall</code> can also be used to call methods of objects by passing an object
instead of a module as the first argument. For example, the following code
will invoke the <code>count</code> method of a list:</p><div class="codeBlockContainer_I0IT language-ocaml theme-code-block"><div class="codeBlockContent_wNvx ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> builtins </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pyimport </span><span class="token string" style="color:#e3116c">&quot;builtins&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> pylist </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pycall builtins </span><span class="token string" style="color:#e3116c">&quot;list&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> ones </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pyconvert </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pycall pylist </span><span class="token string" style="color:#e3116c">&quot;count&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>In the examples above, we use the <code>builtins</code> module to access Python&#x27;s builtins.
Other modules can also be imported as long as they are available in the Python
path: for instance, it is perfectly possible to import <code>numpy</code> or <code>matplotlib</code>,
assuming that they are installed.</p><p>The following example shows how a numpy <code>nparray</code> can be created and converted
to an MCore sequence. The key here is to use numpy&#x27;s <code>tolist</code> method first,
since conversion directly from <code>nparray</code> is not supported.</p><div class="codeBlockContainer_I0IT language-ocaml theme-code-block"><div class="codeBlockContent_wNvx ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> rnd </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pyimport </span><span class="token string" style="color:#e3116c">&quot;numpy.random&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> nparray </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pycall rnd </span><span class="token string" style="color:#e3116c">&quot;normal&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> mc_seq </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pyconvert </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pycall nparray </span><span class="token string" style="color:#e3116c">&quot;tolist&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>In the next example, we use <code>matplotlib</code> to produce a plot; this works in
exactly the same way as in a regular Python program.</p><div class="codeBlockContainer_I0IT language-ocaml theme-code-block"><div class="codeBlockContent_wNvx ocaml"><pre tabindex="0" class="prism-code language-ocaml codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> plt </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pyimport </span><span class="token string" style="color:#e3116c">&quot;matplotlib.pyplot&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> np </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pyimport </span><span class="token string" style="color:#e3116c">&quot;numpy&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> x </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pycall np </span><span class="token string" style="color:#e3116c">&quot;arange&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> y </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pycall np </span><span class="token string" style="color:#e3116c">&quot;cos&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">_</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pycall plt </span><span class="token string" style="color:#e3116c">&quot;plot&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">_</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pycall plt </span><span class="token string" style="color:#e3116c">&quot;show&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="conversion-between-mcore-and-python">Conversion between MCore and Python<a class="hash-link" href="#conversion-between-mcore-and-python" title="Direct link to heading">â€‹</a></h4><p>When calling a Python function using the <code>pycall</code> builtin, the arguments will be
automatically converted from MCore values to Python values. Similarly, the
opposite conversion is performed when using <code>pyconvert</code> on the result of a
<code>pycall</code>. This section explains the details of these conversions.</p><h5 class="anchor anchorWithStickyNavbar_mojV" id="from-mcore-to-python">From MCore to Python<a class="hash-link" href="#from-mcore-to-python" title="Direct link to heading">â€‹</a></h5><table><thead><tr><th align="left">MCore type</th><th align="left">Python type</th></tr></thead><tbody><tr><td align="left">Bool</td><td align="left">bool</td></tr><tr><td align="left">Int</td><td align="left">int</td></tr><tr><td align="left">Char</td><td align="left">N/A</td></tr><tr><td align="left">Float</td><td align="left">float</td></tr><tr><td align="left">[Char]<!-- --> (String)</td><td align="left">str</td></tr><tr><td align="left">[a]</td><td align="left">List</td></tr><tr><td align="left">Unit</td><td align="left">None</td></tr><tr><td align="left">Record</td><td align="left">Dict</td></tr><tr><td align="left">Tuple (Record)</td><td align="left">Tuple</td></tr><tr><td align="left">other</td><td align="left">N/A</td></tr></tbody></table><h5 class="anchor anchorWithStickyNavbar_mojV" id="from-python-to-mcore">From Python to MCore<a class="hash-link" href="#from-python-to-mcore" title="Direct link to heading">â€‹</a></h5><table><thead><tr><th align="left">Python type</th><th align="left">MCore type</th></tr></thead><tbody><tr><td align="left">bool</td><td align="left">Bool</td></tr><tr><td align="left">int</td><td align="left">Int</td></tr><tr><td align="left">long</td><td align="left">Int</td></tr><tr><td align="left">float</td><td align="left">Float</td></tr><tr><td align="left">str</td><td align="left">[Char]<!-- --> (String)</td></tr><tr><td align="left">List</td><td align="left">[a]</td></tr><tr><td align="left">None</td><td align="left">Unit</td></tr><tr><td align="left">Dict</td><td align="left">Record</td></tr><tr><td align="left">Tuple</td><td align="left">Tuple (Record)</td></tr><tr><td align="left">other</td><td align="left">N/A</td></tr></tbody></table><h2 class="anchor anchorWithStickyNavbar_mojV" id="externals">Externals<a class="hash-link" href="#externals" title="Direct link to heading">â€‹</a></h2><p>Externals allows you to interact with code in the compilation target language
from miking. Currently, externals are only available in compiled code and are
in an early stage of development. The example below only covers the case where
OCaml is the target language.</p><p>You can find an example of externals definitions in
<a href="/docs/stdlib/ext/math-ext.mc">stdlib/ext/math-ext.mc</a> and
<a href="/docs/stdlib/ext/math-ext.ext-ocaml.mc">stdlib/ext/math-ext.ext-ocaml.mc</a>.</p><p>For the sake of this example, lets say we want to define the exponential
function and that miking targeting OCaml should use <code>Float.exp</code> from OCaml&#x27;s
standard library for its implementation.</p><p>We first define the external in a file under <a href="/docs/stdlib/ext">stdlib/ext</a>, let&#x27;s
say <a href="/docs/stdlib/ext/math-ext.mc">stdlib/ext/math-ext.mc</a>, as</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">external externalExp : Float -&gt; Float</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>which makes an external value <code>externalExp</code> of type <code>Float -&gt; Float</code> available
at the top-level. The corresponding MCore syntax is:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">external ident : Type in expr</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>If the external has side-effects it should be annotated with a <code>!</code> after the
identifier, e.g.</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">external print ! : String -&gt; ()</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Each external identifier can only be defined once and externals cannot be
partially applied.</p><p>As a temporary solution, the next step is to supply a list of implementation for
our external in the language we target for compilation (in this case OCaml). We
do this by creating a file
<a href="/docs/stdlib/ext/math-ext.ext-ocaml.mc">stdlib/ext/math-ext.ext-ocaml.mc</a>
and in it we define a map from external
identifiers to a list of implementations as follows:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">include &quot;map.mc&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">include &quot;ocaml/ast.mc&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">let mathExtMap =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  use OCamlTypeAst in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  mapFromSeq cmpString</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (&quot;externalExp&quot;, [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        expr = &quot;Float.exp&quot;, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ty = tyarrow_ tyfloat_ tyfloat_ , </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        libraries = [], </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        cLibraries = [] </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>This map associates the <code>externalExp</code> external to a list of expressions in the
target language, which here only has one element, namely the function
<code>Float.exp</code> from OCaml&#x27;s standard library. The field <code>ty</code> encode the OCaml type
of this value (see <a href="/docs/stdlib/ocaml/ast.mc">stdlib/ocaml/ast.mc</a>), which is needed
to convert values between miking and OCaml. In the case where you have multiple
implementations, the compiler will try to pick the implementation which gives
the least amount of overhead when converting to and from OCaml values. The
<code>libraries</code> field list OCaml libraries that are needed to call this function,
and <code>cLibraries</code> lists c libraries that are needed during linking. In this case
none are needed since it is part of the standard library. If let&#x27;s say we wanted
to use <code>Float.exp</code> from a library <code>foo</code>, then we should instead have the field
<code>libraries = [&quot;foo&quot;]</code>. Finally, we need to add <code>mathExtMap</code> to
<code>globalExternalImplsMap</code> in
<a href="/docs/stdlib/ocaml/external-includes.mc">stdlib/ocaml/external-includes.mc</a>.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="conversion-between-values">Conversion between values<a class="hash-link" href="#conversion-between-values" title="Direct link to heading">â€‹</a></h3><p>Conversion between Miking values and OCaml values is defined in
<a href="/docs/stdlib/ocaml/external.mc">stdlib/ocaml/external.mc</a>. Since externals are in an
early stage of development these conversions are not complete and subject to
change. </p><p>The following Basic types are converted without any computational overhead:</p><table><thead><tr><th align="left"><strong>Miking type</strong></th><th align="left"><strong>OCaml type</strong></th></tr></thead><tbody><tr><td align="left"><code>Int</code></td><td align="left"><code>int</code></td></tr><tr><td align="left"><code>Float</code></td><td align="left"><code>float</code></td></tr><tr><td align="left"><code>Bool</code></td><td align="left"><code>bool</code></td></tr></tbody></table><p>The overhead of converting sequences to OCaml data-structures is proportional to
the length of the sequence times the conversion cost for the type of the
elements. Strings in Miking is a special case of sequences.</p><table><thead><tr><th align="left"><strong>Miking type</strong></th><th align="left"><strong>OCaml type</strong></th><th align="left"><strong>Comment</strong></th></tr></thead><tbody><tr><td align="left"><code>[A]</code></td><td align="left"><code>&#x27;a list</code></td><td align="left"></td></tr><tr><td align="left"><code>[A]</code></td><td align="left"><code>&#x27;a array</code></td><td align="left">A copy is made, mutating the OCaml array does not mutate the sequence.</td></tr><tr><td align="left"><code>[Char]</code> or <code>String</code></td><td align="left"><code>string</code></td><td align="left">The Miking string is converted to, and the OCaml string is assumed to be, encoded in UTF-8.</td></tr></tbody></table><p>Tensors are passed by reference to OCaml, i.e. mutating the corresponding
data-structure in OCaml will mutate the tensor. As a temporary solution the
conversion depends on the underlying implementation of the tensor, which is
controlled by the tensor create functions <code>tensorCreateDense</code>,
<code>tensorCreateCArrayInt</code>, and <code>tensorCreateCArrayFloat</code>. The main purpose of the
latter two is to allow data-sharing with C libraries via OCaml bindings.</p><table><thead><tr><th align="left"><strong>Miking type</strong></th><th align="left"><strong>OCaml type</strong></th><th align="left"><strong>Comment</strong></th></tr></thead><tbody><tr><td align="left"><code>Tensor[Int]</code></td><td align="left"><code>Bigarray.((int, int_elt, c_layout) genarray.t)</code></td><td align="left">Must use <code>tensorCreateCArrayInt</code>, otherwise a runtime error occurs.</td></tr><tr><td align="left"><code>Tensor[Float]</code></td><td align="left"><code>Bigarray.((float, float64_elt, c_layout) genarray.t)</code></td><td align="left">Must use <code>tensorCreateCArrayFloat</code>, otherwise a runtime error occurs.</td></tr><tr><td align="left"><code>Tensor[Int]</code> of rank 1</td><td align="left"><code>Bigarray.((int, int_elt, c_layout) Array1.t)</code></td><td align="left">Must use <code>tensorCreateCArrayInt</code>, otherwise a runtime error occurs.</td></tr><tr><td align="left"><code>Tensor[Float]</code> of rank 1</td><td align="left"><code>Bigarray.((float, float64_elt, c_layout) Array1.t)</code></td><td align="left">Must use <code>tensorCreateCArrayFloat</code>, otherwise a runtime error occurs.</td></tr></tbody></table><p>Tuples are converted without overhead if the conversion of their elements are
without overhead. The same is true for arrow types. The fields in Miking records
are un-ordered while they are ordered in OCaml so there is some overhead
involved when converting records as each field of the Miking records needs to be
projected to form an new OCaml records, and vice versa. The fields of the Miking
record are associated with the fields of the OCaml record syntactically by
position when defining the external. As an example, if the external</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">external myRecord : {a : Int, b: Float}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>has an OCaml implementation with type <code>{c : int; d : float}</code> then the field <code>a</code> is
associated with the field <code>c</code> and the field <code>b</code> with the field <code>d</code>.</p><p>If the Miking type is abstract, i.e. we define it as </p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">type MyType</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>then no conversion is performed to and from this type.</p><p>Please consult <a href="/docs/stdlib/ext/ext-test.mc">stdlib/ext/ext-test.mc</a> and
<a href="/docs/stdlib/ext/ext-test.ext-ocaml.mc">stdlib/ext/ext-test.ext-ocaml.mc</a>, for more
examples.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="sundials">Sundials<a class="hash-link" href="#sundials" title="Direct link to heading">â€‹</a></h3><p>A more involved example on the use of externals is an interface to the
<a href="https://computing.llnl.gov/projects/sundials" target="_blank" rel="noopener noreferrer">Sundials</a> numerical DAE solver.
You find the implementation in
<a href="/docs/stdlib/sundials/sundials.mc">stdlib/sundials/sundials.mc</a> and
<a href="/docs/stdlib/sundials/sundials.ext-ocaml.mc">stdlib/sundials/sundials.ext-ocaml.mc</a>.
Note that these externals depends on the library <code>sundialsml</code>.</p><p>Installing this library involves first installing the Sundials C library. On
<code>ubuntu 20.04</code> you can do this by:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt-get install libsundials-dev</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>On <code>macOS</code>, using Homebrew, you instead do:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">brew install sundials</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Then install the ocaml bindings
<a href="https://inria-parkas.github.io/sundialsml/" target="_blank" rel="noopener noreferrer">SundialsML</a> via <code>opam</code></p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">opam install sundialsml</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Currently, this library cannot be installed on the multi-core switch but you
instead have to use another opam switch, e.g.</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">opam switch 4.12.0</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>After this you have to rebuild the compiler, e.g.</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">make clean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">make</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>To run the sundials-specific test suite, use the command:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">make test-sundials</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>To install for the current user, run <code>make install</code> as usual.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="ipopt">Ipopt<a class="hash-link" href="#ipopt" title="Direct link to heading">â€‹</a></h3><p>Another example use of externals is an interface to the constrained Non-Linear
Program solver <a href="https://coin-or.github.io/Ipopt/" target="_blank" rel="noopener noreferrer">Ipopt</a>. This interface is
defined in <a href="/docs/stdlib/ipopt/ipopt.mc">stdlib/ipopt/ipopt.mc</a> and
<a href="/docs/stdlib/ipopt/ipopt.ext-ocaml.mc">stdlib/ipopt/ipopt.ext-ocaml.mc</a>. This library
depends on both the OCaml library <a href="https://github.com/br4sco/ipoptml" target="_blank" rel="noopener noreferrer">ipoptml</a>
and the ipopt c library.</p><p>To use this library you need to do the following:</p><p>Install the ipopt c library, which you can do on ubuntu 20.04 with</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt-get install coinor-libipopt-dev</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Install dependencies for <a href="https://github.com/br4sco/ipoptml" target="_blank" rel="noopener noreferrer">ipoptml</a>,</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">opam install ctypes ctypes-foreign</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Clone the <a href="https://github.com/br4sco/ipoptml" target="_blank" rel="noopener noreferrer">ipoptml</a> repo and in its root run</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">dune build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dune install</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>You can then test the solver in Miking with</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">make test-ipopt</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="external-dependent-utests-pruning">External Dependent Utests Pruning<a class="hash-link" href="#external-dependent-utests-pruning" title="Direct link to heading">â€‹</a></h3><p>As part of the parsing (see <code>prune_external_utests</code> in <code>parserutils.ml</code> for
details) utests that depend on externals are marked and removed. This done in
the following steps:</p><ol><li>Dead code removal is performed to remove dead code, including any dead code
inside utests that might reference externals. This is done to reduce the
number of false positivities.</li><li>Utests that references externals are marked and removed.</li><li>Dead code removal is run again to remove any dead code that result from the
removal of utests in step 2.</li></ol><p>Additionally, if <code>boot</code> or <code>mi</code> is run without the <code>--test</code> flag, all utests are
removed prior to dead code removal as all utests can then be considered dead
code. This both allows the dead code removal to remove more dead code and
simplifies the pruning of utests implementation. If any utest pruning is
performed, a warning summarizing pruned utests is printed to <em>stdout</em>.</p><p>The pruning of utests can be disabled with the <code>--disable-prune-utests</code> flag and
debugged with <code>--debug-prune-utests</code> (only in boot).</p><p>Moreover, pruning of utests can be disabled for a selection of externals, which
allows for a more granular approach to the testing of external dependent code
(see below).</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="selective-pruning">Selective pruning<a class="hash-link" href="#selective-pruning" title="Direct link to heading">â€‹</a></h4><p>During compilation, the available OCaml packages on the
current system is queried and externals depending on these packages are excluded
from utests pruning. In other words, utests that depend on externals that can be
compiled on the system are kept, while all others are removed. The listing of
OCaml packages is based around <code>dune installed-libraries</code> (see
<code>externalListOcamlPackages</code> and <code>externalGetSupportedExternalImpls</code> in
<code>external-includes.mc</code> so this functionality should not require any additional
dependencies. For boot and the interpreter, <em>all</em> external dependent utests are
removed as these currently do not support externals at all.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="test-organization">Test organization<a class="hash-link" href="#test-organization" title="Direct link to heading">â€‹</a></h4><p><code>make test-all</code> runs all tests, disabling utest pruning for compiled files
(i.e. if dependencies are not met, you get an error). The recepie <code>make
test-all-prune-utests</code> runs all tests but prunes non-supported utests which is
handy if your system only meet the dependencies of a subset of the
externals. Interpreted files are always pruned of external dependent
utests. Please consult the makefiles for more details.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="authoring-new-external-libraries">Authoring new external libraries<a class="hash-link" href="#authoring-new-external-libraries" title="Direct link to heading">â€‹</a></h4><p>To maintain the flexibility of the test organization, future external libraries
must ensure that externals, or external dependent identifiers are only fully
applied inside utests. To verify that this is the case you can just run <code>boot
eval --test &lt;file.mc&gt;</code> and verify that you get a non-zero exit code on the
library that you are currently working on.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="parallel-programming">Parallel Programming<a class="hash-link" href="#parallel-programming" title="Direct link to heading">â€‹</a></h3><p>Miking offers a set of externals for shared-memory parallelism using
atomic operations and threads running on multiple cores.</p><p>The parallel programming primitives consist of atomic references and functions
for creating and synchronizing threads. In addition to the examples below, more
documentation can be found in the standard library at
<a href="/docs/stdlib/multicore">stdlib/multicore</a>.</p><p>To use the parallel programming externals, ensure that you are on the
<code>4.12.0+domains</code>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/tree/4.12+domains" target="_blank" rel="noopener noreferrer">switch</a>.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="atomic-references">Atomic References<a class="hash-link" href="#atomic-references" title="Direct link to heading">â€‹</a></h4><p>Atomic references are similar to ordinary references, except that operations
performed on them are <em>atomic</em>, which means that no other execution thread can
interfere with the result. In other words, they are safe to use in
multi-threaded execution. Atomic references are provided in
<a href="/docs/stdlib/multicore/atomic.mc">multicore/atomic.mc</a>.</p><p><code>atomicMake</code> creates a new atomic reference and gives it an initial value. The
value of the atomic reference can be read by <code>atomicGet</code>:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">include &quot;multicore/atomic.mc&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mexpr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">let a = atomicMake 0 in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">utest atomicGet a with 0 in</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p><code>atomicCAS a oldVal newVal</code> performs an atomic compare-and-set, that is, it only
updates the value of <code>a</code> to <code>newVal</code> if the current value is identical to
<code>oldVal</code>, and then returns a Boolean representing if the update was successful
or not:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">utest atomicCAS a 0 1 with true in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">utest atomicCAS a 42 3 with false in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">utest atomicGet a with 1 in</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The compare-and-set operation is currently supported for integer atomic
references only.</p><p>To unconditionally set the value of an atomic reference, we can use
<code>atomicExchange</code>, which also returns the old value of the reference:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">utest atomicExchange a 2 with 1 in</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Finally, for integer references, we can use <code>atomicFetchAndAdd</code> to increase or
decrease the value of the reference. The function returns the old value of the
reference:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">utest atomicFetchAndAdd a 1 with 2 in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- Current value is now 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">utest atomicFetchAndAdd a (subi 0 45) with 3 in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- Current value is now -42</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="multi-threaded-execution">Multi-Threaded Execution<a class="hash-link" href="#multi-threaded-execution" title="Direct link to heading">â€‹</a></h4><p>Functions for handling threads are provided in
<a href="/docs/stdlib/multicore/threads.mc">multicore/threads.mc</a>.
The following example program spawns 10 threads that compete for printing their
IDs:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">include &quot;string.mc&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">include &quot;multicore/thread.mc&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mexpr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">let place = atomicMake 1 in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">let threads = create 10 (lam. threadSpawn (lam.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  print (join</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [int2string (atomicFetchAndAdd place 1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    , &quot;: thread ID &quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    , int2string (threadSelf ())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    , &quot;\n&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ]))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">) in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">map threadJoin threads</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>where <code>threadSpawn</code> takes a function of type <code>Unit -&gt; a</code> as argument
and <code>threadSelf</code> returns the ID of the current thread. Note that
<code>threadJoin</code> must be called once for each call to <code>threadSpawn</code>. The
output of the above program might be:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">1: thread ID 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2: thread ID 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3: thread ID 129</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4: thread ID 130</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">5: thread ID 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">6: thread ID 257</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">7: thread ID 258</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">8: thread ID 131</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">9: thread ID 385</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">10: thread ID 386</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>However, the values and order of the thread IDs might be different over
different runs.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="synchronization">Synchronization<a class="hash-link" href="#synchronization" title="Direct link to heading">â€‹</a></h4><p>Externals for thread synchronization in the form of mutual exclusion locks and
condition variables are defined in
<a href="/docs/stdlib/multicore/mutex.mc">multicore/mutex.mc</a> and
<a href="/docs/stdlib/multicore/cond.mc">multicore/cond.mc</a>, respectively.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="probability-distributions">Probability distributions<a class="hash-link" href="#probability-distributions" title="Direct link to heading">â€‹</a></h3><p>Externals for probability distributions are defined in <code>stdlib/ext/dist-ext.mc</code>. To use these, you must install the <code>opam</code> package <code>owl</code> (i.e., <code>opam install owl</code>)</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="profiling">Profiling<a class="hash-link" href="#profiling" title="Direct link to heading">â€‹</a></h2><p>Profiling of an MExpr program can be enabled using the <code>--debug-profile</code> flag
when compiling or evaluating a program. While this flag also exists in the boot
interpreter, it produces a subset of profiling information than the profiling
approach used in <code>mi</code> (which is what is detailed below).</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="profiling-output">Profiling output<a class="hash-link" href="#profiling-output" title="Direct link to heading">â€‹</a></h3><p>The profiling results are stored in a file <code>mexpr.prof</code> in the current working
directory. If such a file already exists, it will be overwritten. This file
is created when:</p><ul><li>The execution of a compiled program, which had been compiled with the
<code>--debug-profile</code> flag enabled, terminates.</li><li>The interpreter of a program terminates, and the <code>--debug-profile</code> flag was
enabled.</li></ul><p>Note that no profiling information is generated during the compilation step,
because the profiling code is instrumented into the produced binary.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="output-format">Output format<a class="hash-link" href="#output-format" title="Direct link to heading">â€‹</a></h4><p>The profiling output contains one line per top-level function in the program,
excluding those that are never used during an execution of the program. The
order of the lines is based on the order in which the functions have been
defined in the program. Functions defined in included files will also be listed
in the profiling output, given that they are used.</p><p>Each line of output consists of five space-separated columns:</p><ol><li>A string, denoting the name of the file and the position within the file,
encoded as <code>[&lt;start row&gt;:&lt;start col&gt;-&lt;end row&gt;:&lt;end col&gt;]</code>, where the function
is defined.</li><li>A string, denoting the name of the function.</li><li>An integer, denoting the number of calls made to the function. The counter
includes self-recursive calls.</li><li>A floating-point number, denoting the exclusive time spent in the function.
This is the time spent in a call, except the time spent in calls to other
top-level functions (including itself).</li><li>A floating-point number, denoting the inclusive time spent in the function.
This is the total time spent in all calls to the function, including that
spent in calls to other top-level functions. As this includes self-recursive
calls, this value may be greater than the total runtime.</li></ol><h4 class="anchor anchorWithStickyNavbar_mojV" id="postprocessing">Postprocessing<a class="hash-link" href="#postprocessing" title="Direct link to heading">â€‹</a></h4><p>The output format was chosen to be easily sorted using external tools, such as
the <code>sort</code> command in Unix. Below we provide two examples of how the output can
be sorted. These assume that the profiling output is stored in <code>mexpr.prof</code> and
that the sorted profiling output should be stored in <code>sorted.prof</code>.</p><p>To sort the functions by the number of times they were called, with the most
frequently called function at the top:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">cat mexpr.prof | sort -k3 -r -n &gt; sorted.prof</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>To sort the functions by the exclusive time spent within them, placing the
function with the highest exclusive time at the top:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">cat mexpr.prof | sort -k4 -r -g &gt; sorted.prof</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="notes">Notes<a class="hash-link" href="#notes" title="Direct link to heading">â€‹</a></h3><p>This instrumentation is currently only performed on functions defined on the
top-level in a program. The runtime of local functions and intrinsic functions
is instead added to the top-level function in which they are used. In addition,
partially applied functions are not profiled.</p><p>Importantly, this profiling works by instrumenting the code with extra calls.
The runtime overhead when enabling this flag is significant, especially when
using the evaluator.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="acceleration">Acceleration<a class="hash-link" href="#acceleration" title="Direct link to heading">â€‹</a></h2><p>When the <code>--accelerate</code> flag is set when using <code>mi compile</code>, parts of the
program can be compiled in an accelerated mode. The main part of the program
will be compiled to the default backend (currently OCaml), while expressions
that have been wrapped in an <code>accelerate</code> term will be compiled to an
accelerated backend. Additional compiler flags can be used to control which
accelerated mode should be used. Acceleration requires <code>futhark</code> to be
installed
(<a href="https://futhark.readthedocs.io/en/stable/installation.html" target="_blank" rel="noopener noreferrer">installation instructions</a>).</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="accelerated-modes">Accelerated modes<a class="hash-link" href="#accelerated-modes" title="Direct link to heading">â€‹</a></h3><p>The default acceleration mode translates the accelerated parts of the code to
CUDA GPU code via Futhark. This mode requires an NVidia GPU and an installation
of CUDA at <code>/usr/local/cuda</code>.</p><p>If the <code>--cpu-only</code> flag is set, the accelerated parts of the code are instead
translated to multicore CPU code. This mode does not require an NVidia GPU, nor
does it require any additional installations apart from <code>futhark</code>.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="usage-1">Usage<a class="hash-link" href="#usage-1" title="Direct link to heading">â€‹</a></h3><p>The accelerated compilation via <code>mi compile --accelerate</code> makes use of parallel
keywords. The most important keyword is <code>accelerate</code>, whose only argument is an
expression that is requested to be accelerated. The other keywords are used for
accelerate-specific operations, such as <code>map2</code> and <code>parallelReduce</code>. There are
several limitations on what expressions may be used. If an accelerated
expression attempts to make use of an unsupported subexpression, an error is
reported.</p><p>When the <code>--accelerate</code> flag is not set, the <code>accelerate</code> keywords are removed
from the program, and parallel constructs are replaced by equivalent sequential
code.</p><p>Acceleration has significant overheads, as data used within the accelerated
expression are copied between the default backend and the accelerated backend
every time it is evaluated. This overhead is particularly noticable when using
the GPU accelerate backend. In addition, the first use of acceleration in a
program has additional overhead, because a Futhark context needs to be set up.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="recommended-workflow">Recommended workflow<a class="hash-link" href="#recommended-workflow" title="Direct link to heading">â€‹</a></h4><p>The recommended workflow when working with acceleration is to first implement
the program in MExpr without using acceleration. In this stage, the compiler
should be used in debug mode, that is, using the flags <code>--test</code> and
<code>--runtime-checks</code> to provide clear errors when the program does not behave as
expected.</p><p>Once the implementation is considered ready for acceleration, expressions can
be marked for acceleration by using the <code>accelerate</code> keyword. If this results
in compilation errors when the <code>--accelerate</code> flag is set, the program needs to
be rewritten according to what the error states.</p><p>After the program can be compiled with acceleration enabled, the program can be
executed. The accelerated program will only encounter a runtime error if the
program compiled in debug mode (with <code>--test</code> and <code>--runtime-checks</code> enabled)
also does. In this case, the debug mode should be used for better error
messages.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="supported-accelerate-constructs">Supported accelerate constructs<a class="hash-link" href="#supported-accelerate-constructs" title="Direct link to heading">â€‹</a></h4><p>The following keywords are reserved for accelerate-specific constructs:</p><ul><li><code>accelerate</code> - marks expressions that should be accelerated. Nested
<code>accelerate</code> terms are not allowed.</li><li><code>parallelFlatten</code> - flattens a two-dimensional sequence, producing a
one-dimensional sequence. The term <code>parallelFlatten s</code> is equivalent to
<code>foldl concat [] s</code>.</li><li><code>map2</code> - performs a <code>map</code> operation over two sequences that are assumed to be
of the same length.</li><li><code>parallelReduce</code> - performs a reduction over elements of a sequence. If the
applied function is associative and the initial accumulator value is the
neutral element of this function, the result of <code>parallelReduce f a s</code> will
be equivalent to that of <code>foldl f a s</code>, but it will be computed in parallel.</li></ul><p>The parallel constructs, apart from <code>accelerate</code>, need to be placed within an
<code>accelerate</code> term in order for them to be parallelised. If they are placed
anywhere else, they will be generated as their sequential counterparts.</p><p>In general, the <code>foldl</code> intrinsic should be used over the <code>parallelReduce</code>. If
the compiler can determine that the given function <code>f</code> is associative
(currently, if it is <code>addi</code> or <code>muli</code>), the <code>foldl</code> is promoted to a
<code>parallelReduce</code>.</p><p>Note in particular that floating-point addition and multiplication is not
associative due to precision errors. Should these errors not be of any concern
to the user, the <code>parallelReduce</code> construct may be used in place of <code>foldl</code> to
force parallel execution. Also, note that an associative function must take two
arguments of the same type, and this is a requirement on the function passed to
<code>parallelReduce</code>.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="example">Example<a class="hash-link" href="#example" title="Direct link to heading">â€‹</a></h4><p>Assume that the following program is given:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">include &quot;common.mc&quot; -- printLn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mexpr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">let addOne : Float -&gt; Float = lam x. addf x 1.0 in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">printLn (float2string (addOne 25.0));</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>To accelerate the expression <code>addOne 25.0</code>, it is passed as an argument to the
<code>accelerate</code> keyword, resulting in <code>accelerate (addOne 25.0)</code>. If this program
is compiled with the <code>--accelerate</code> flag, it will produce an executable where
the evaluation of <code>addOne 25.0</code> is performed in the accelerated mode. Should it
be compiled without the <code>--accelerate</code> flag set, the <code>accelerate</code> keyword is
removed by the compiler and the program behaves as in the original version.</p><p>See the <a href="/docs/test/examples/accelerate">accelerate examples</a> directory for more
elaborate examples.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="sequence-sizes">Sequence sizes<a class="hash-link" href="#sequence-sizes" title="Direct link to heading">â€‹</a></h3><p>A significant difference between MExpr and Futhark is that the latter includes
the size of a sequence as part of its type. This means that, for example, when
a function returns a two-dimensional sequence, the inner sequences must all
have the same size (otherwise they would have different types). As this is not
required by MExpr, there are situations where one may need to provide
additional information in MExpr to help the Futhark compiler.</p><p>Such information is provided through <code>utest</code> expressions of specific shapes.
The idea is that, when the program is compiled in debug mode, the <code>utest</code>
expressions are checked at runtime. If such a <code>utest</code> fails at runtime when
compiled in debug mode, it would also fail in the accelerated code, but likely
with a less understandable error message.</p><p>In the future, the accelerate compiler will statically check that the necessary
size constraints have been added. For now, failing to provide sufficient
information results in a Futhark compilation error.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="size-coercions">Size coercions<a class="hash-link" href="#size-coercions" title="Direct link to heading">â€‹</a></h4><p>Consider the following example</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">mexpr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">let g : [Int] -&gt; [Int] = lam s. snoc s 5 in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">let f : [[Int]] -&gt; [[Int]] = lam s. map g s in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">let s : [[Int]] = [[1,2],[3,4]] in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">let s : [[Int]] = accelerate (f s) in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">s</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>In the function <code>g</code>, the size of the array is increased because <code>snoc</code> appends
an integer element to the end of the given sequence. In this case, the size of
the output sequence is not the same as the size of the input sequence. Because
of this, the Futhark compiler cannot show that all inner sequences produced in
the <code>map</code> of the <code>f</code> function will have the same size.</p><p>We can show this by adding a <code>utest</code> of the shape <code>utest length s with n in e</code>
within the inner function. Here <code>s</code> is an expression referring to a sequence
and <code>n</code> is a variable from an outer scope (or a parameter), such that the
compiler knows it is the same for every inner sequence. We rewrite <code>f</code> as</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">let f : [[Int]] -&gt; [[Int]] = lam s.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -- &#x27;n&#x27; is defined outside the map function so that the compiler knows this</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -- size will be the same for every inner sequence.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  let n = addi (length s) 1 in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  map</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (lam inner : [Int].</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      let inner : [Int] = g inner in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      utest length inner with n in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      inner)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">in</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="size-equality">Size equality<a class="hash-link" href="#size-equality" title="Direct link to heading">â€‹</a></h4><p>Consider the following implementation of the transpose operation on a square
matrix:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">let transposeSq : [[Int]] -&gt; [[Int]] = lam m.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  let n = length m in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  create n (lam i : Int.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let inner : [Int] = create n (lam j : Int. get (get m j) i) in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    inner)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The implementation accepts a matrix of any form, even though this would only
work for a square matrix. By inserting a <code>utest</code> of the form
<code>utest length m with length (head m) in e</code> (we assume inner dimensions are
non-empty), we can express an equality constraint between the first two
dimensions of the matrix <code>m</code>, which may be needed when this function is used in
other places.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="limitations">Limitations<a class="hash-link" href="#limitations" title="Direct link to heading">â€‹</a></h3><p>There are several limitations on what expressions can be accelerated. These
limitations apply to the accelerated expressions as well as any code these
depend on. Most limitations are checked at compile-time, but a few may result
in runtime errors.</p><p>The current implementation has the following limitations:</p><ul><li>Side-effects are not allowed in accelerated code. Note that the example above
used <code>printLn</code> which has a side-effect, but that this was used outside of the
accelerated parts.</li><li>The inner sequences of multi-dimensional sequences must have the same size.
Without providing the necessary hints to the compiler, this results in a
compile-time error. If the provided hints are not always valid, this may
result in a runtime error.</li><li>Recursion is not supported in accelerated code. The compiler has a limiited
ability to rewrite recursive bindings that are equivalent to <code>map</code> and
<code>foldl</code>. Should this fail, and recursive bindings remain after this step, the
compilation fails.</li><li>Records and tuples may not be directly used in an accelerated expression, nor
may the result use such types. Records and tuples may however be used within
a function that is used by accelerated code.</li><li>Algebraic data types and map intrinsics may not be used in accelerated code.</li><li>Matching on sequences is limited to patterns of the form <code>[h] ++ t</code>.</li><li>Higher-order functions (an expression of a function type) cannot be:<ol><li>Stored in a sequence</li><li>The result of a conditional expression</li><li>Used as the accumulator of a fold</li></ol></li><li>Performing dynamic allocations, by using <code>concat</code> or <code>create</code>, within a
parallel construct may result in a compile-time error when generating GPU
code. This is due to a known limitation of the Futhark compiler.</li><li>Polymorphism is not supported in accelerated code.</li></ul><p>In addition, the accelerated AST must be annotated with types. This is
particularly important for the accelerated expressions. If the compiler does
not have sufficient annotations, it may give an error or generate code that
crashes at runtime.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="auto-tuning">Auto Tuning<a class="hash-link" href="#auto-tuning" title="Direct link to heading">â€‹</a></h2><p>An MExpr program can contain decision variables, or so called holes, whose
values are to be decided by an autotuner. A hole is introduced into a program
using the keyword <code>hole</code>. The <code>hole</code> takes as argument the type of the hole
(either <code>Boolean</code> or <code>IntRange</code>) and its default value. Additionally, an
<code>IntRange</code> hole expects a minimum and maximum value.</p><p>For example, the following defines a function <code>sort</code> that chooses sorting
algorithm based on input data length.</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">let sort = lam seq.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  let threshold = hole (IntRange {default = 10, min = 0, max = 10000}) in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if leqi (length seq) threshold then insertionSort seq</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  else mergeSort seq</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">in</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>We can invoke the autotuner using the <code>mi tune</code> subcommand:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">mi tune sort.mc</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The autotuner uses offline profiling in order to assign the holes values such
that the execution time of the program is minimized. Available command-line
options (for setting search strategy, stopping condition, etc.) are listed in
<code>stdlib/tuning/tune-options.mc</code>.</p><p>The result of <code>mi tune</code> is a tune file, which by default is written to
<code>sort.tune</code> (if your program is called <code>sort.mc</code>). To compile the program using
the tuned values, invoke the main compiler with the <code>--tuned</code> option:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">mi compile --tuned sort.mc</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Passing the <code>--tuned</code> flag to <code>mi tune</code> makes the auto tuner restart the tuning
using the values in the tune file as start values:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">mi compile --tuned sort.mc</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>To tune and compile the program in one go, provide the <code>--compile</code>
flag to <code>mi tune</code>:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">mi tune --compile sort.mc</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Note that <code>mi compile sort.mc</code> compiles the program using the default values of
the holes.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="context-dependent-holes">Context-Dependent Holes<a class="hash-link" href="#context-dependent-holes" title="Direct link to heading">â€‹</a></h3><p>A <code>hole</code> takes an additional (optional) parameter <code>depth</code>, which represents the
length of the most recent function call history that should influence the choice
of the value of the hole. By default (if not provided), then <code>depth</code> is 0, which
means that the hole is assigned one value globally by the autotuner. If <code>depth</code>
is larger than 0, then the hole is potentially assigned a different values for
each possible context.</p><p>For instance, the following defines a function <code>hcreate</code> that chooses between
two sequence representations:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">let hcreate = lam n. lam f.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  let rope = hole (Boolean {default = true, depth = 1}) in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (if rope then createRope else createList) n f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">in</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The hole <code>rope</code> has <code>depth</code> one, which means that its value might be different
for two different calls to <code>hcreate</code>.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="contributing">Contributing<a class="hash-link" href="#contributing" title="Direct link to heading">â€‹</a></h2><ol><li><p>Before making a pull request please make sure that all tests pass. Run
appropriate tests as described above.</p></li><li><p>Make sure you follow the conventions declared in the
<a href="https://github.com/miking-lang/miking/wiki/Conventions" target="_blank" rel="noopener noreferrer">wiki</a>.</p></li><li><p>We use <a href="https://github.com/ocaml-ppx/ocamlformat" target="_blank" rel="noopener noreferrer">ocamlformat</a> to
automatically format ocaml source code.</p></li></ol><h3 class="anchor anchorWithStickyNavbar_mojV" id="setup-and-use-ocamlformat">Setup and use <code>ocamlformat</code><a class="hash-link" href="#setup-and-use-ocamlformat" title="Direct link to heading">â€‹</a></h3><p>We are currently using this package at version <code>0.20.1</code>. To pin and/or install
the package at this version using <code>opam</code> do</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">opam pin ocamlformat 0.20.1</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Then you can then run <code>dune build @fmt</code> to see a
diff between your code and the formatted code. To promote the changes run <code>dune
promote</code>. To do these two steps in one run <code>dune build @fmt --auto-promote</code>. If
you want to, you can run <code>ocamlformat</code> in watch mode to continuously format the
source as you work on it with the command <code>dune build @fmt --auto-promote -w</code>.
You can also find instructions for tighter editor integration at <em>ocamlformat&#x27;s</em>
GitHub page.</p><p>For convenience, <code>make lint</code> will run <code>dune build @fmt</code> and <code>make fix</code> will run
<code>dune build @fmt --auto-promote</code>.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="git-blame">Git Blame<a class="hash-link" href="#git-blame" title="Direct link to heading">â€‹</a></h3><p>Since automatic code formatting commits will obscure <code>git blame</code> we maintain a
file  <a href="/docs/.git-blame-ignore-revs">.git-blame-ignore-revs</a> that will contain the
commit hashes of code formatting commits. We can then run <code>git blame</code>, ignoring
these commits as:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">git blame &lt;file(s)&gt; --ignore-revs-file .git-blame-ignore-revs</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>To make this setting persistent you can configure git like this:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">git config blame.ignoreRevsFile .git-blame-ignore-revs</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>These instructions are adapted from
<a href="https://github.com/psf/black" target="_blank" rel="noopener noreferrer">https://github.com/psf/black</a>. See
<a href="https://git-scm.com/docs/git-blame#Documentation/git-blame.txt---ignore-revltrevgt" target="_blank" rel="noopener noreferrer">https://git-scm.com/docs/git-blame#Documentation/git-blame.txt---ignore-revltrevgt</a>
for documentation on the <code>--ignore-revs-file</code> option.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="mit-license">MIT License<a class="hash-link" href="#mit-license" title="Direct link to heading">â€‹</a></h2><p>Miking is licensed under the MIT license.</p><p>Copyright 2017-2021 David Broman</p><p>Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the &quot;Software&quot;), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:</p><p>The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.</p><p>THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/miking-dppl"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Miking DPPL</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#getting-started" class="table-of-contents__link toc-highlight">Getting started</a><ul><li><a href="#the-repl" class="table-of-contents__link toc-highlight">The REPL</a></li></ul></li><li><a href="#editor-support" class="table-of-contents__link toc-highlight">Editor Support</a></li><li><a href="#mcore" class="table-of-contents__link toc-highlight">MCore</a></li><li><a href="#mexpr" class="table-of-contents__link toc-highlight">MExpr</a><ul><li><a href="#unit-test-expressions" class="table-of-contents__link toc-highlight">Unit Test Expressions</a></li><li><a href="#intrinsics" class="table-of-contents__link toc-highlight">Intrinsics</a></li><li><a href="#let-expressions" class="table-of-contents__link toc-highlight">Let Expressions</a></li><li><a href="#functions" class="table-of-contents__link toc-highlight">Functions</a></li><li><a href="#sequencing" class="table-of-contents__link toc-highlight">Sequencing</a></li><li><a href="#if-expressions" class="table-of-contents__link toc-highlight"><code>if</code> Expressions</a></li><li><a href="#recursion" class="table-of-contents__link toc-highlight">Recursion</a></li><li><a href="#tuples" class="table-of-contents__link toc-highlight">Tuples</a></li><li><a href="#records" class="table-of-contents__link toc-highlight">Records</a></li><li><a href="#data-types-and-match-expressions" class="table-of-contents__link toc-highlight">Data Types and <code>match</code> expressions</a></li><li><a href="#pattern-matching" class="table-of-contents__link toc-highlight">Pattern matching</a></li><li><a href="#sequences" class="table-of-contents__link toc-highlight">Sequences</a></li><li><a href="#tensors" class="table-of-contents__link toc-highlight">Tensors</a></li><li><a href="#references" class="table-of-contents__link toc-highlight">References</a></li></ul></li><li><a href="#mlang" class="table-of-contents__link toc-highlight">MLang</a><ul><li><a href="#top-level-definitions-and-includes" class="table-of-contents__link toc-highlight">Top-Level Definitions and Includes</a></li><li><a href="#language-fragments" class="table-of-contents__link toc-highlight">Language Fragments</a></li><li><a href="#known-issuesfuture-work" class="table-of-contents__link toc-highlight">Known Issues/Future Work</a></li></ul></li><li><a href="#externals-builtin" class="table-of-contents__link toc-highlight">Externals (builtin)</a><ul><li><a href="#python" class="table-of-contents__link toc-highlight">Python</a></li></ul></li><li><a href="#externals" class="table-of-contents__link toc-highlight">Externals</a><ul><li><a href="#conversion-between-values" class="table-of-contents__link toc-highlight">Conversion between values</a></li><li><a href="#sundials" class="table-of-contents__link toc-highlight">Sundials</a></li><li><a href="#ipopt" class="table-of-contents__link toc-highlight">Ipopt</a></li><li><a href="#external-dependent-utests-pruning" class="table-of-contents__link toc-highlight">External Dependent Utests Pruning</a></li><li><a href="#parallel-programming" class="table-of-contents__link toc-highlight">Parallel Programming</a></li><li><a href="#probability-distributions" class="table-of-contents__link toc-highlight">Probability distributions</a></li></ul></li><li><a href="#profiling" class="table-of-contents__link toc-highlight">Profiling</a><ul><li><a href="#profiling-output" class="table-of-contents__link toc-highlight">Profiling output</a></li><li><a href="#notes" class="table-of-contents__link toc-highlight">Notes</a></li></ul></li><li><a href="#acceleration" class="table-of-contents__link toc-highlight">Acceleration</a><ul><li><a href="#accelerated-modes" class="table-of-contents__link toc-highlight">Accelerated modes</a></li><li><a href="#usage-1" class="table-of-contents__link toc-highlight">Usage</a></li><li><a href="#sequence-sizes" class="table-of-contents__link toc-highlight">Sequence sizes</a></li><li><a href="#limitations" class="table-of-contents__link toc-highlight">Limitations</a></li></ul></li><li><a href="#auto-tuning" class="table-of-contents__link toc-highlight">Auto Tuning</a><ul><li><a href="#context-dependent-holes" class="table-of-contents__link toc-highlight">Context-Dependent Holes</a></li></ul></li><li><a href="#contributing" class="table-of-contents__link toc-highlight">Contributing</a><ul><li><a href="#setup-and-use-ocamlformat" class="table-of-contents__link toc-highlight">Setup and use <code>ocamlformat</code></a></li><li><a href="#git-blame" class="table-of-contents__link toc-highlight">Git Blame</a></li></ul></li><li><a href="#mit-license" class="table-of-contents__link toc-highlight">MIT License</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/miking">Miking</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/miking-dppl">Miking DPPL</a></li></ul></div><div class="col footer__col"><div class="footer__title">Links</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/miking-lang/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 David Broman</div></div></div></footer></div>
<script src="/assets/js/runtime~main.0e06f18a.js"></script>
<script src="/assets/js/main.e62b6b25.js"></script>
</body>
</html>